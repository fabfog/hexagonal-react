import {
  ReactiveStore,
  ReactiveValue,
  DisposableClass,
  DisposableProperty,
  EventHandlerBuilder,
  EventSubscription,
} from "@dxbox/use-less-react/classes";
import type {
  HybridCommandBus,
  HybridEventBusInterface,
  QueryBus,
  DisposableResource,
} from "@dxbox/use-less-react/classes";

/**
 * {{pascalCase name}}ViewModel for {{pascalCase name}} UI
 *
 * This is an **inbound adapter** that converts UI events into domain commands/queries.
 *
 * Responsibilities:
 * - Manages UI state
 * - Handles user actions
 * - Communicates with use-cases via command/query buses
 * - Notifies React components of state changes via ReactiveStore
 *
 * Usage with @dxbox/use-less-react:
 * - Uses ReactiveStore for reactive updates
 * - Consumed by React components via useDisposable + useReactiveStoreValues hooks
 */
@DisposableClass
export class {{pascalCase name}}ViewModel implements DisposableResource {
  @DisposableProperty
  store = new ReactiveStore({
    isLoading: new ReactiveValue(false),
    error: new ReactiveValue<string | null>(null),
    // TODO: Add more state properties
  });

  @DisposableProperty
  private eventSubscriptions = new EventSubscription(() => {
    const builder = new EventHandlerBuilder(this.eventBus);
    // TODO: Register event handlers
    // builder.on<EventClass>(EventClass.prototype.type, async (event) => {})
    return builder.build();
  });

  constructor(
    private readonly commandBus: HybridCommandBus,
    private readonly queryBus: QueryBus,
    private readonly eventBus: HybridEventBusInterface
  ) {}

  // Getters for convenience
  get isLoading(): boolean {
    return this.store.values.isLoading.get();
  }

  get error(): string | null {
    return this.store.values.error.get();
  }

  dispose(): void {
    // @DisposableClass automatically disposes @DisposableProperty fields
  }

  // TODO: Add action methods
}
